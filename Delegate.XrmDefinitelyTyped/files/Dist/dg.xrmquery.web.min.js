var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),XrmQuery;!function(t){function e(t,e){return XQW.RetrieveRecord.Get(t,e)}function n(t){return XQW.RetrieveMultipleRecords.Get(t)}function r(t,e,n){return XQW.RetrieveRecord.Related(t,e,n)}function i(t,e,n){return XQW.RetrieveMultipleRecords.Related(t,e,n)}function o(t,e){return new XQW.CreateRecord(t,e)}function s(t,e,n){return new XQW.UpdateRecord(t,e,n)}function u(t,e){return new XQW.DeleteRecord(t,e)}function a(t){XQW.ApiUrl=t}function c(t){XQW.ApiUrl=XQW.getDefaultUrl(t)}function l(t,e,n,r,i,o){void 0===i&&(i=function(){});var s=new XMLHttpRequest;s.open(t,e,!0),s.setRequestHeader("Accept","application/json"),s.setRequestHeader("Content-Type","application/json; charset=utf-8"),s.setRequestHeader("OData-MaxVersion","4.0"),s.setRequestHeader("OData-Version","4.0"),o&&o(s),s.onreadystatechange=function(){4==this.readyState&&(s.onreadystatechange=null,200==this.status||204==this.status?r(this):i(new Error(this.response)))},s.send(n)}function f(t,e,n,r,i,o){l(t,encodeURI(XQW.getApiUrl()+e),n,r,i,o)}function h(t,e,n,r){return XQW.promisifyCallback(function(i,o){return f(t,e,n,i,o,r)})}t.retrieve=e,t.retrieveMultiple=n,t.retrieveRelated=r,t.retrieveRelatedMultiple=i,t.create=o,t.update=s,t.deleteRecord=u,t.setApiUrl=a,t.setApiVersion=c,t.request=l,t.sendRequest=f,t.promiseRequest=h}(XrmQuery||(XrmQuery={}));var Filter;!function(t){function e(t,e){return v(t,"eq",e)}function n(t,e){return v(t,"ne",e)}function r(t,e){return v(t,"gt",e)}function i(t,e){return v(t,"ge",e)}function o(t,e){return v(t,"lt",e)}function s(t,e){return v(t,"le",e)}function u(t,e){return R(t,"and",e)}function a(t,e){return R(t,"or",e)}function c(t){return"not "+t}function l(t){return k(t,"and")}function f(t){return k(t,"or")}function h(t,e){return m("startswith",t,e)}function p(t,e){return m("contains",t,e)}function d(t,e){return m("endswith",t,e)}function y(t){return XQW.makeTag(t)}function g(t){return null==t?"null":"string"==typeof t?"'"+t+"'":t instanceof Date?t.toISOString():t.toString()}function v(t,e,n){return g(t)+" "+e+" "+g(n)}function m(t,e,n){return t+"("+g(e)+", "+g(n)+")"}function R(t,e,n){return"("+t+" "+e+" "+n+")"}function k(t,e){var n=t.pop();return t.reduceRight(function(t,n){return R(n,e,t)},n)}t.equals=e,t.notEquals=n,t.greaterThan=r,t.greaterThanOrEqual=i,t.lessThan=o,t.lessThanOrEqual=s,t.and=u,t.or=a,t.not=c,t.ands=l,t.ors=f,t.startsWith=h,t.contains=p,t.endsWith=d,t.makeGuid=y}(Filter||(Filter={}));var XQW;!function(t){function e(t){return{__str:t,toString:function(){return this.__str}}}function n(t,e){return t.substr(-e.length)==e}function r(t,e){return t.substr(0,e.length)==e}function i(t,e){if(w.test(e))return new Date(e);var i=t,o=n(i,R);if(o&&(i=i.substr(0,i.length-42)),r(i,"_")&&n(i,"_value")&&(i=i.substr(1,i.length-7),o||(i+=S)),o&&(i+=x),i==t)return e;this[i]=e}function o(t){return JSON.parse(t.response,i)}function s(t){return t.length>0&&"string"==typeof t[0]}function u(t){if(!Promise)throw new Error("Promises are not natively supported in this browser. Add a polyfill to use it.");return new Promise(function(e,n){t(e,n)})}function a(t){return t(f(t))}function c(t){return new RegExp("\\b"+t+"\\.([a-zA-Z_$][0-9a-zA-Z_$]*)(\\.([a-zA-Z_$][0-9a-zA-Z_$]*))?","g")}function l(t){var e=t.toString().match(N);if(!e)throw new Error("XrmQuery: Unable to properly parse function: "+t.toString());return{arg:e[1],body:e[2]}}function f(e){for(var n,r=l(e),i=c(r.arg),o={};null!=(n=i.exec(r.body));)o[n[1]]||(o[n[1]]=t.makeTag(n[1])),n[3]&&(o[n[1]][n[3]]=t.makeTag(n[1]+"/"+n[3]));return o}function h(t){return d()+"/api/data/v"+t+"/"}function p(){return null===t.ApiUrl&&(t.ApiUrl=h(j)),t.ApiUrl}function d(){try{if(GetGlobalContext&&GetGlobalContext().getClientUrl)return GetGlobalContext().getClientUrl()}catch(t){}try{if(Xrm&&Xrm.Page&&Xrm.Page.context)return Xrm.Page.context.getClientUrl()}catch(t){}throw new Error("Context is not available.")}function y(t){var e=t.indexOf(S);return-1==e?t:"_"+t.substr(0,e)+"_value"}function g(t){return a(t).map(function(t){return y(t.toString())})}function v(t){if(t instanceof Object){var e={};return Object.keys(t).forEach(function(n){return m(n,v(t[n]),e)}),e}if(t instanceof Array){var n=[];return t.forEach(function(t,e){return n[e]=v(t)}),n}return t}function m(t,e,n){var r=t.indexOf(b);if(r>=0){var i=t.substr(r+b.length);n[t.substr(0,r)+"@odata.bind"]="/"+i+"("+e+")"}else n[t]=e}var R="@OData.Community.Display.V1.FormattedValue",k={type:"Prefer",value:'odata.include-annotations="OData.Community.Display.V1.FormattedValue"'},b="_bind$",S="_guid",x="_formatted",_=function(t){return{type:"Prefer",value:"odata.maxpagesize="+t}};t.makeTag=e;var w=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/;t.promisifyCallback=u;var Q=function(){function t(t,e,n){var r=this;this.toReturn=t,this.successCallback=e,this.errorCallback=n,this.missingCallbacks=0,this.isDoneSending=!1,this.isDoingWork=!1,this.callbackReceived=function(){r.missingCallbacks--,r.allSent&&0==r.missingCallbacks&&r.successCallback(r.toReturn)}}return t.prototype.followLink=function(t,e,n){var r=this;this.performingCallback(),XrmQuery.request("GET",t,null,function(t){var i=o(t);C.followLinks(i,e,function(t){n(t),r.callbackReceived()},r.errorCallback)},function(t){r.callbackReceived(),r.errorCallback(t)})},t.prototype.populateRecord=function(t,e){this.performingCallback(),A.followLinks(t,e,this.callbackReceived,this.errorCallback)},t.prototype.allSent=function(){if(!this.isDoingWork)return this.successCallback(this.toReturn);this.isDoneSending=!0},t.prototype.performingCallback=function(){this.missingCallbacks++,this.isDoingWork=!0},t}(),A=function(t){function e(e,n,r,i){var o=t.call(this,e,r,i)||this;return n.forEach(function(t){var n=e[t.linkKey];n&&(delete e[t.linkKey],o.followLink(n,[],function(n){e[t.arrKey]=e[t.arrKey].concat(n)}))}),o.allSent(),o}return __extends(e,t),e.followLinks=function(t,n,r,i){return 0==n.length?r(t):(s(n)&&(n=n.map(function(t){return{arrKey:t,linkKey:t+"@odata.nextLink"}})),new e(t,n,r,i))},e}(Q),C=function(t){function e(e,n,r,i){var o=t.call(this,e.value,r,i)||this,s=e["@odata.nextLink"];return s&&o.followLink(s,n,function(t){o.toReturn=o.toReturn.concat(t)}),n.length>0&&e.value.forEach(function(t){return o.populateRecord(t,n)}),o.allSent(),o}return __extends(e,t),e.followLinks=function(t,n,r,i){if(!t["@odata.nextLink"]&&(0==t.value.length||0==n.length))return r(t.value);if(0==n.length)return new e(t,[],r,i);if(s(n)&&(n=n.map(function(t){return{arrKey:t,linkKey:t+"@odata.nextLink"}})),0==t.value.length)return new e(t,n,r,i);var o=t.value[0];return new e(t,n.filter(function(t){return o[t.linkKey]}),r,i)},e}(Q),X=function(){function t(t){this.requestType=t,this.additionalHeaders=[],this.getObjectToSend=function(){return null}}return t.prototype.promise=function(){return u(this.execute.bind(this))},t.prototype.execute=function(t,e){void 0===e&&(e=function(){}),this.executeRaw(t,e,!0)},t.prototype.executeRaw=function(t,e,n){var r=this;void 0===e&&(e=function(){}),void 0===n&&(n=!1);var i=function(t){return r.additionalHeaders.forEach(function(e){return t.setRequestHeader(e.type,e.value)})},o=function(i){return n?r.handleResponse(i,t,e):t(i)};return XrmQuery.sendRequest(this.requestType,this.getQueryString(),this.getObjectToSend(),o,e,i)},t}();t.Query=X;var O=function(t){function e(e,n,r){var i=t.call(this,"GET")||this;return i.entitySetName=e,i.id=n,i.relatedNav=r,i.specialQuery=void 0,i.selects=[],i.expands=[],i.expandKeys=[],i.ordering=[],i.skipAmount=null,i.topAmount=null,i}return __extends(e,t),e.Get=function(t){return new e(a(t).toString())},e.Related=function(t,n,r){return new e(a(t).toString(),n,a(r).toString())},e.prototype.handleResponse=function(t,e,n){C.followLinks(o(t),this.expandKeys,e,n)},e.prototype.getFirst=function(t,e){this.top(1),this.execute(function(e){return t(e&&e.length>0?e[0]:null)},e)},e.prototype.promiseFirst=function(){return u(this.getFirst.bind(this))},e.prototype.getQueryString=function(){var t=this.entitySetName;if(this.id&&this.relatedNav&&(t+="("+this.id+")/"+this.relatedNav),this.specialQuery)return t+this.specialQuery;var e=[];return this.selects.length>0&&e.push("$select="+this.selects.join(",")),this.expands.length>0&&e.push("$expand="+this.expands.join(",")),this.filters&&e.push("$filter="+this.filters),this.ordering.length>0&&e.push("$orderby="+this.ordering.join(",")),null!=this.skipAmount&&e.push("$skip="+this.skipAmount),null!=this.topAmount&&e.push("$top="+this.topAmount),t+(e.length>0?"?"+e.join("&"):"")},e.prototype.select=function(t){return this.selects=g(t),this},e.prototype.selectMore=function(t){return this.selects=this.selects.concat(g(t)),this},e.prototype.expand=function(t,e){var n=a(t).toString();this.selects.push(n),this.expandKeys.push(n);var r=[];return e&&r.push("$select="+g(e)),this.expands.push(n+(r.length>0?"("+r.join(";")+")":"")),this},e.prototype.filter=function(t){return this.filters=a(t),this},e.prototype.orFilter=function(t){return this.filters?this.filters=Filter.or(this.filters,a(t)):this.filter(t),this},e.prototype.andFilter=function(t){return this.filters?this.filters=Filter.and(this.filters,a(t)):this.filter(t),this},e.prototype.order=function(t,e){return this.ordering.push(a(t)+" "+e),this},e.prototype.orderAsc=function(t){return this.order(t,"asc")},e.prototype.orderDesc=function(t){return this.order(t,"desc")},e.prototype.skip=function(t){return this.skipAmount=t,this},e.prototype.top=function(t){return this.topAmount=t,this},e.prototype.maxPageSize=function(t){return this.additionalHeaders.push(_(t)),this},e.prototype.includeFormattedValues=function(){return this.additionalHeaders.push(k),this},e.prototype.useFetchXml=function(t){return this.specialQuery="?fetchXml="+encodeURI(t),this},e.prototype.usePredefinedQuery=function(t,e){return this.specialQuery="?"+t+"="+e,this},e}(X);t.RetrieveMultipleRecords=O;var D=function(t){function e(e,n,r){var i=t.call(this,"GET")||this;return i.entitySetName=e,i.id=n,i.relatedNav=r,i.selects=[],i.expands=[],i.expandKeys=[],i}return __extends(e,t),e.Related=function(t,n,r){return new e(a(t).toString(),n,a(r).toString())},e.Get=function(t,n){return new e(a(t).toString(),n)},e.prototype.handleResponse=function(t,e,n){A.followLinks(o(t),this.expandKeys,e,n)},e.prototype.select=function(t){return this.selects=g(t),this},e.prototype.selectMore=function(t){return this.selects=this.selects.concat(g(t)),this},e.prototype.expand=function(t,e,n){var r=a(t).toString();this.selects.push(r),this.expandKeys.push(r);var i=[];return e&&i.push("$select="+g(e)),n&&(n.top&&i.push("$top="+n.top),n.orderBy&&i.push("$orderby="+a(n.orderBy)+" "+(2!=n.sortOrder?"asc":"desc")),n.filter&&i.push("$filter="+a(n.filter))),this.expands.push(r+(i.length>0?"("+i.join(";")+")":"")),this},e.prototype.getQueryString=function(){var t=[];this.selects.length>0&&t.push("$select="+this.selects.join(",")),this.expands.length>0&&t.push("$expand="+this.expands.join(","));var e=this.entitySetName+"("+this.id+")";return this.relatedNav&&(e+="/"+this.relatedNav),e+(t.length>0?"?"+t.join("&"):"")},e.prototype.includeFormattedValues=function(){return this.additionalHeaders.push(k),this},e}(X);t.RetrieveRecord=D;var E=function(t){function e(e,n){var r=t.call(this,"POST")||this;return r.record=n,r.getObjectToSend=function(){return JSON.stringify(v(r.record))},r.entitySetName=a(e).toString(),r}return __extends(e,t),e.prototype.handleResponse=function(t,e,n){var r=t.getResponseHeader("OData-EntityId");r?e(r.substr(-37,36)):n(new Error("No valid OData-EntityId found in header."))},e.prototype.setData=function(t){return this.record=t,this},e.prototype.getQueryString=function(){return this.entitySetName},e}(X);t.CreateRecord=E;var T=function(t){function e(e,n){var r=t.call(this,"DELETE")||this;return r.id=n,r.entitySetName=a(e).toString(),r}return __extends(e,t),e.prototype.handleResponse=function(t,e){e()},e.prototype.setId=function(t){return this.id=t,this},e.prototype.getQueryString=function(){return this.entitySetName+"("+this.id+")"},e}(X);t.DeleteRecord=T;var W=function(t){function e(e,n,r){var i=t.call(this,"PATCH")||this;return i.id=n,i.record=r,i.getObjectToSend=function(){return JSON.stringify(v(i.record))},i.entitySetName=a(e).toString(),i}return __extends(e,t),e.prototype.handleResponse=function(t,e){e()},e.prototype.setData=function(t,e){return this.id=t,this.record=e,this},e.prototype.getQueryString=function(){return this.entitySetName+"("+this.id+")"},e}(X);t.UpdateRecord=W;var N=/function[^\(]*\(([a-zA-Z0-9_]+)[^\{]*\{([\s\S]*)\}$/m;t.ApiUrl=null;var j="8.0";t.getDefaultUrl=h,t.getApiUrl=p}(XQW||(XQW={}));